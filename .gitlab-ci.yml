#Help: https://docs.gitlab.com/ee/ci/yaml/
#Validation: https://gitlab.com/roleone/webapp/-/ci/lint
.node: &node
  image: node:latest
  cache:
    key: "$CI_COMMIT_REF_SLUG"
    paths:
    - node_modules/

stages:
  - build
  - test
  - deploy

build_dev:
  stage: build
  environment:
    name: dev
  <<: *node
  script:
    - npm install
    - npm run builddev

build_master:
  stage: build
  environment:
    name: production
  <<: *node
  script:
    - npm install
    - npm run build
  only:
    - master

protactor_and_karma_test:
  stage: test
  script:
    - npm install
    - npm test --progress false --single-run=true --watch=false
    - npm e2e --progress false --watch=false

deploy_production_firebase:
  stage: deploy
  environment:
    name: production
  <<: *node
  script:
    - npm install
    - npm run deploy
  only:
    - master
